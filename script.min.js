// @ts-nocheck
import{createClient}from"https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";const cors="https://minesweeper.fr/prox.php?url=",supabase=createClient("https://ybnsbhhdtqytccpcegzq.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlibnNiaGhkdHF5dGNjcGNlZ3pxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzIxOTk5MDAsImV4cCI6MjA0Nzc3NTkwMH0.RxiKoFjoSGmNGzSZ-MH41bG1-XhFT4bIxWYs2onQRxc");let toRead=[];async function load(){let{data:e,error:t}=await supabase.from("Liste").select("*").order("titre",{ascending:!0});const a=document.createElement("progress");a.max=e.length,a.value=0,document.getElementById("toRead").appendChild(a);for(const t of e)await checkManga(t),progressAdd(1,a);a.remove(),0==toRead.length&&(document.getElementById("toRead").innerHTML="Nothing is updated")}function materializeListe(e){let t=document.createElement("div");t.classList.add("div1"),document.getElementById("AlreadyRead").appendChild(t);let a=document.createElement("button");t.appendChild(a),a.classList.add("del"),a.innerHTML="Del!",a.onclick=async()=>{if(confirm("Do you realy want to delete "+e.titre)){const{error:t}=await supabase.from("Liste").delete().eq("id",e.id);location.reload()}},t.onclick=t=>{t.target!=a&&window.open(e.url,"_blank").focus()};let n=document.createElement("img");t.appendChild(n),n.src=e.img;let i=document.createElement("p");t.appendChild(i),i.classList.add("title"),i.innerHTML=e.titre}function materializeChapter(e){let t=document.createElement("div");t.classList.add("div1"),document.getElementById("toRead").appendChild(t);let a=document.createElement("p");t.appendChild(a),a.classList.add("title"),a.innerHTML=e.manga.titre,a.onclick=()=>window.open(e.manga.url,"_blank").focus();let n=document.createElement("div");n.classList.add("div2"),t.appendChild(n);let i=document.createElement("buttonDiv");i.id="buttonDiv",t.appendChild(i);let d=document.createElement("button");i.appendChild(d),d.classList.add("allRead"),d.innerHTML="All Read",d.onclick=async()=>{const{data:t,error:a}=await supabase.from("Liste").update({lastRead:e.chapters[0].innerHTML}).eq("id",e.manga.id).select();location.reload()};let l=document.createElement("button");i.appendChild(l),l.classList.add("del"),l.innerHTML="Del!",l.onclick=async()=>{if(confirm("Do you realy want to delete "+e.manga.titre)){const{error:t}=await supabase.from("Liste").delete().eq("id",e.manga.id)}};let r=document.createElement("img");n.appendChild(r),r.src=e.manga.img;let s=document.createElement("div");s.classList.add("chapters"),n.appendChild(s),e.chapters.forEach((t=>{t.target="_blank",s.appendChild(t),t.onclick=async()=>{const{data:a,error:n}=await supabase.from("Liste").update({lastRead:t.innerHTML}).eq("id",e.manga.id).select();location.reload()}}))}async function checkManga(e){const t=await fetch(cors+e.url),a=await t.text(),n=(new DOMParser).parseFromString(a,"text/html"),i=Array.from(n.getElementsByClassName("chapter-name"));let d=[];for(let t=0;t<i.length;t++){let a=i[t];if(a.innerHTML===e.lastRead)break;d.push(a)}d.length>0&&(toRead.push({manga:e,chapters:d}),materializeChapter({manga:e,chapters:d})),materializeListe(e)}function progressAdd(e,t,a=0){t.value+=e/100,setTimeout((()=>{a<100*e&&progressAdd(e,t,a+1)}),.5)}load(),document.getElementById("addMangaButton").onclick=async()=>{const e=document.getElementById("inputManga").value,t=await fetch(cors+e),a=await t.text(),n=(new DOMParser).parseFromString(a,"text/html"),i=n.querySelector(".story-info-right h1").innerHTML,d=n.querySelector(".info-image img").src,l=Array.from(n.getElementsByClassName("chapter-name"))[0].innerHTML;await supabase.from("Liste").insert([{url:e,titre:i,lastRead:l,img:d}]),document.getElementById("inputManga").value=""};